저번주에 python3.7-> 3.8
tensorflow 1.14 -> 2.3.0 으로 프로젝트의 파이썬과 tensorflow 버전을 바꾸는 작업을 마쳤다

docker에서 이미지를 tar로 저장하여 로컬 컴퓨터에 이미지를 추가하는 작업 후
코드수정을 통해 프로젝트를 작동시켰다 

하지만 속도 이슈가 있어서 찾아본 결과 tensorflow버전이 바뀌면서 성능저하가 있었다 

그래서 tensorflow의 eager모드를 다시 graph모드로 변경했더니 원래의 속도를 찾았다

속도저하의 이유
TF2.x는 eager모드가 기본이다
eager모드를 끄고 예전 graph모드로 되돌리는 과정에서 set_sesion이 필요했다(찾아봐야함)
구글링해보니 명확하게 이유를 설명하는 공식 문서는 없었다 그래도 사람들이 공유한 자료를 요약해 봤다
graph는 선언후 계속 호출하여 실행되는 반면
eager는 실행 될 때마다 모든것(graph를 생성)을 실행한다
eager는 graph가 없는 것이 아니며 graph를 구성하는 상당 부분은 모델,가중치,optimizer이다
eager는 실행시 자체 그래프의 일부만 빌드하는데 여기에 오버해드가 있기 떄문에 성능이 저하된다
eager는 numpy 입력시에 더 느리다 그이유는 cpu에서 gpu로 텐서를 복가하는 오버헤드 비용이 포함되기 때문이다
eager는 numpy를 직접 전달하고 graph는 numpy로 평가되는 텐서르 전달한다
TF2 Eager는 TF1 Eager보다 느리다 -이유가 확실하지 않다, 개발자가 명확히 답변을 업데이트할 예정이라고 한다

내일은 기존에 작성된 코드를 분석해서 성능개선할수 있는지 혹은 ML을 도입할 만한 곳이 있는지 파악 할 것이다

빠르게만 가는 것이 무슨 의미가 있는지 생각해보게되는 하루였다
깊이있고 명확하게 알고 있어야 앞으로에 개발에 도움이 되지 않을까?
너무 성급하지 말고 명확하게 알자
